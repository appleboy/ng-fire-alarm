/*! ng-fire-alarm - v 0.3.1 - Fri Jan 17 2014 17:09:39 GMT+0800 (CST)
 * https://github.com/tomchentw/ng-fire-alarm
 * Copyright (c) 2014 [tomchentw](https://github.com/tomchentw/);
 * Licensed [MIT](http://tomchentw.mit-license.org/)
 */(function(){function t(t){var i,n;return i=t.val(),"object"==typeof i&&(i.$name=t.name(),n=t.getPriority(),angular.isDefined(n)&&(i.$priority=n)),i}function i(t,i,n){i["$"+n]=function(){var i;t.updateRef((i=t._ref)[n].apply(i,arguments))}}function n(t,i){function n(){}return n.prototype=(t.superclass=i).prototype,(t.prototype=new n).constructor=t,"function"==typeof i.extended&&i.extended(t),t}function e(t,i){var n={}.hasOwnProperty;for(var e in i)n.call(i,e)&&(t[e]=i[e]);return t}var r,o,s,a,h={}.toString;r=function(){function t(t,i,n){this._ref=t,this._defer=i,this._singlecton=!!n,this.startWatching()}t.displayName="FirebaseNotifier";var i=t.prototype;return i.updateRef=function(t){var i,n;i={},n=this._ref,n.on("value",angular.noop,angular.noop,i),this.stopWatching(),this._ref=t,this.startWatching(),n.off("value",void 0,i)},i.startWatching=function(){this._ref.on("value",this.onValue,this.onError,this)},i.stopWatching=function(){this._ref.off("value",void 0,this)},i.onError=function(t){this._defer.reject(t)},i.notify=function(t){this._defer.notify(this._singlecton||t)},i.onValue=function(t){var i;i=t.val(),this._singlecton===!0?this._singlecton=i:h.call(this._singlecton).slice(8,-1)===h.call(i).slice(8,-1)&&angular.extend(this._singlecton,i),this.notify(this._singlecton||i)},t}(),o=function(i){function r(){r.superclass.apply(this,arguments)}var o=n((e(r,i).displayName="FireResourceNotifier",r),i).prototype;return o.onValue=angular.noop,o.startWatching=function(){i.prototype.startWatching.apply(this,arguments),this._names={},this._singlecton=[],this._ref.on("child_added",this.onChildChanged,this.onError,this),this._ref.on("child_changed",this.onChildChanged,this.onError,this),this._ref.on("child_moved",this.onChildChanged,this.onError,this),this._ref.on("child_removed",this.onChildRemoved,this.onError,this)},o.stopWatching=function(){this._ref.off("child_added",void 0,this),this._ref.off("child_changed",void 0,this),this._ref.off("child_moved",void 0,this),this._ref.off("child_removed",void 0,this),i.prototype.stopWatching.apply(this,arguments)},o.notify=function(){this._singlecton[0]=angular.fromJson(angular.toJson(this._singlecton[0])),i.prototype.notify.call(this)},o.rebuildNameIndex=function(t,i){var n,e,r,o,s,a;for(n=this._singlecton,e=this._names,r=t,o=i||n.length;o>r;++r)s=r,a=n[s],"object"==typeof a&&(e[a.$name]=s,a.$index=s)},o.indexOf=function(t){return t in this._names?this._names[t]:-1},o.onChildChanged=function(i,n){var e,r,o,s;e=this._singlecton,r=this.indexOf(i.name()),-1!==r&&e.splice(r,1),o=t(i),s=1+this.indexOf(n),e.splice(s,0,o),this.rebuildNameIndex(s),this.notify()},o.onChildRemoved=function(t){var i;i=this.indexOf(t.name()),this._singlecton.splice(i,1),this.rebuildNameIndex(i),this.notify()},r}(r),s=["limit","startAt","endAt"],a=["$q","Firebase"].concat(function(t,n){function e(i,n,e){n["$"+e]=function(n){var r;return r=t.defer(),i[e](n,angular.bind(r,h)),r.promise}}var a,h;return a=["push","update","set","setPriority"],h=function(t){this[t?"reject":"resolve"](t)},function(f,c,l){var u,d,g,p,_,v,m,y,b;for(angular.isString(f)&&(f=new n(f)),u=t.defer(),d=u.promise,g=angular.isArray(c)?o:r,p=new g(f,u,l),_={$promise:d,$thenNotify:angular.bind(d,d.then,void 0,void 0)},v=0,y=(m=s).length;y>v;++v)b=m[v],i(p,_,b);for(v=0,y=(m=a).length;y>v;++v)b=m[v],e(f,_,b);return _.$setWithPriority=function(i,n){var e;return e=t.defer(),f.setWithPriority(i,n,angular.bind(e,h)),e.promise},_.$remove=function(){var i;return i=t.defer(),f.remove(angular.bind(i,h)),i.promise},_}}),angular.module("ng.fire.alarm",[]).value("Firebase",Firebase).factory("$fireAlarm",a)}).call(this);