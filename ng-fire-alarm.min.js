/*! ng-fire-alarm - v 0.4.1 - Sat Feb 08 2014 02:01:41 GMT+0800 (CST)
 * https://github.com/tomchentw/ng-fire-alarm
 * Copyright (c) 2014 [tomchentw](https://github.com/tomchentw/);
 * Licensed [MIT](http://tomchentw.mit-license.org/)
 */(function(){function t(t,i){return o(i)&&(i.$name=t.name(),i.$priority=t.getPriority()),i}function i(i,n){var e;return e=i.val(),null===e?t(i,n):o(e)?(t(i,e),o(n)?angular.extend(n,e):e):e}function n(t){return function(i){i?t.reject(i):t.resolve()}}function e(t,i){function n(){}return n.prototype=(t.superclass=i).prototype,(t.prototype=new n).constructor=t,"function"==typeof i.extended&&i.extended(t),t}function r(t,i){var n={}.hasOwnProperty;for(var e in i)n.call(i,e)&&(t[e]=i[e]);return t}var o,s,a,h,u,c=[].slice;o=angular.isObject,s=function(){function t(t,i,n){this._query=t,this._defer=i,this._isSingleton=!0===n.singlecton,this._singlecton=void 0,this.startWatching()}t.displayName="AlarmReceiver";var i=t.prototype,n=t;return t.create=function(t,i,n){var e;return new(e=!0===n.collection?h:a)(t,i,n)},i.update=function(t,i){var e;return e=this._query,e.on("value",angular.noop,angular.noop,n),this.stopWatching(),this._query=e[t](i),this.startWatching(),e.off("value",void 0,n)},i.notify=function(t){this._defer.notify(this._isSingleton?this._singlecton:t)},i.onError=function(t){this._defer.reject(t)},t}(),a=function(t){function n(){n.superclass.apply(this,arguments)}var o=e((r(n,t).displayName="Fireman",n),t).prototype;return o.startWatching=function(){this._query.on("value",this.onValue,this.onError,this)},o.stopWatching=function(){this._query.off("value",void 0,this)},o.onValue=function(t){var n;n=i(t,this._singlecton),this._isSingleton&&!this._singlecton&&(this._singlecton=n),this.notify(n)},n}(s),h=function(t){function n(){n.superclass.apply(this,arguments),this._isSingleton=!0,this._singlecton=[],this._names={}}var s=e((r(n,t).displayName="Firemen",n),t).prototype;return s.notify=function(){var i;(i=this._singlecton[0])&&(this._singlecton[0]=JSON.parse(JSON.stringify(i))),t.prototype.notify.call(this)},s.startWatching=function(){this._query.on("child_added",this.onChildChanged,this.onError,this),this._query.on("child_changed",this.onChildChanged,this.onError,this),this._query.on("child_moved",this.onChildChanged,this.onError,this),this._query.on("child_removed",this.onChildRemoved,this.onError,this)},s.stopWatching=function(){this._query.off("child_added",void 0,this),this._query.off("child_changed",void 0,this),this._query.off("child_moved",void 0,this),this._query.off("child_removed",void 0,this)},s.rebuildNameIndex=function(t,i){var n,e,r,s,a,h;for(n=this._singlecton,e=this._names,r=t,s=i||n.length;s>r;++r)a=r,h=n[a],o(h)&&(h.$index=e[h.$name]=a)},s.indexOf=function(t,i){var n,e;return n=this._names,t in n?(e=n[t],i&&delete n[t],e):-1},s.onChildChanged=function(t,n){var e,r,o,s,a;e=this._singlecton,r=t.name(),o=this.indexOf(r,!0),-1!==o&&(s=e.splice(o,1)[0]),a=this._names[r]=1+this.indexOf(n),e.splice(a,0,i(t,s)),this.rebuildNameIndex(a),this.notify()},s.onChildRemoved=function(t){var i;i=this.indexOf(t.name(),!0),this._singlecton.splice(i,1),this.rebuildNameIndex(i),this.notify()},n}(s),u=function(){function t(t,i){this.$promise=t,this._alarmReceiver=i}t.displayName="FireAlarm";var i,e,r=t.prototype,o=t;return t.$q=void 0,r.$query=function(){return this._alarmReceiver._query},r.$ref=function(){return this.$query().ref()},i=["limit","startAt","endAt"],angular.forEach(i,function(t){r["$"+t]=function(i){this._alarmReceiver.update(t,i)}}),e=["remove","push","update","set","setPriority","setWithPriority"],angular.forEach(e,function(t,i){var e;e=function(){switch(i){case 0:return 0;case 5:return 2;default:return 1}}(),r["$"+t]=function(){var i,r,s;return i=c.call(arguments,0,e),r=o.$q.defer(),i.push(n(r)),(s=this.$ref())[t].apply(s,i),r.promise}}),r.$thenNotify=function(t){return this.$promise.then(void 0,void 0,t)},t}(),angular.module("ng-fire-alarm",[]).value("Firebase",Firebase).run(["$q","Firebase"].concat(function(t,i){return u.$q=t,i.prototype.$toAlarm=function(i){var n,e;return i||(i={}),n=t.defer(),e=s.create(this,n,i),new u(n.promise,e,i)}}))}).call(this);