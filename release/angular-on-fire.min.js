/*! angular-on-fire - v0.2.0 - 2013-10-22
 * Copyright (c) 2013 [tomchentw](https://github.com/tomchentw/);
 * Licensed MIT */
(function(){function a(a,b){function c(){}return c.prototype=(a.superclass=b).prototype,(a.prototype=new c).constructor=a,"function"==typeof b.extended&&b.extended(a),a}function b(a,b){var c={}.hasOwnProperty;for(var d in b)c.call(b,d)&&(a[d]=b[d]);return a}function c(a,b){var c,d=function(e){return a.length>1?function(){var f=e?e.concat():[];return c=b?c||this:this,f.push.apply(f,arguments)<a.length&&arguments.length?d.call(c,f):a.apply(c,f)}:a};return d()}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[].slice;d=angular.noop,e=angular.identity,f=angular.bind,g=angular.forEach,h=angular.copy,i=angular.isObject,j=angular.isFunction,k=angular.isString,l=angular.isNumber,m=angular.equals,n={on:d,off:d},o=/\{\{\s*(\S*)\s*\}\}/g,p=function(a,b,c){var d,e,f,g,h,i,j;for(e=[],f=0,h=(g=c.split(o)).length;h>f;++f)i=f,j=g[f],i%2?e.push(b(j)):e.push(j);return d=e,function(b){var c,e,f,g,h,i,j;for(c="",e=0,g=(f=d).length;g>e;++e){if(h=e,i=f[e],h%2){if(j=i(a)||i(b),l(j)&&(j+=""),!k(j)||!j.length)return}else j=i;c+=j}return c}},q={},q.auth=function(a,b,c,d){return function(a,e){var f,g,h;f=e.root,g=e.next,h=new d(new c(f),function(a,c){(a||!c)&&(c={}),b(function(){g(w(c,h))})})}},r=function(){function a(){}a.displayName="DSL";var b=a.prototype;return b._cloneThenPush=function(a){var b,c,d,e,f,g;if(b=new this.constructor,c=[],this.steps)for(d=0,f=(e=this.steps).length;f>d;++d)g=e[d],c.push(h(g,{}));return c.push(a),b.steps=c,b},b._build=function(){delete this.steps},a}(),s=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireAuthDSL",d),c).prototype;return e.root=function(a){var b;return((b=this.steps||(this.steps=[]))[0]||(b[0]={})).root=a,this},e._build=function(a,b){var d;d=this.steps[0],d.next=b,q.auth(a,d),c.prototype._build.apply(this,arguments)},d}(r),t=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireObjectDSL",d),c).prototype;return e._build=function(a,b){var d,e,f,h,i;d=this.steps,f=0<(e=d.length-1)?D.call(d,0,e):(e=0,[]),h=d[e],i=f[0]||h,h.next=b,g(f,function(b,c){var d;d=f[c+1]||h,b.next=function(b){q[d.type](a,(d.results=b,d))}}),q[i.type](a,i),c.prototype._build.apply(this,arguments)},e.get=function(a){return this._cloneThenPush({type:"get",interpolateUrl:a,regularize:this.constructor.regularize})},d}(r),u=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireCollectionDSL",d),c).prototype;return e.map=function(a){return this._cloneThenPush({type:"map",interpolateUrl:a})},e.flatten=function(){return this._cloneThenPush({type:"flatten"})},d}(t),q.flatten=function(a,b){return function(a,c){function d(a,b){b.match(/^\$/)||(a=y(a),a.$name=b,a.$index=-1+h.push(a))}var e,f,h,i,j,k;for(e=c.results,f=c.next,h=[],i=0,j=e.length;j>i;++i)k=e[i],g(k,d);b(function(){f(h)})}},q.get=function(a,b,c,e,f){return function(c,e){var g,h,i,j,l,m,o,q,r;g=e.interpolateUrl,h=e.regularize,i=e.next,j=p(c,a,g),l=n,m=function(a){if(l.toString()!==a){if(o(),!k(a))return i(void 0);l=f(a),l.on("value",d,void 0,n),l.on("value",r,void 0,l)}},o=function(){l.off("value",void 0,l)},q=null,r=function(a){b(function(){i(h(a))})},c.$watch(j,m),c.$on("$destroy",o)}},q.map=function(a,b,e,h,i){var j;return j=/\{\{\s*(\S*)\s*\}\}/g,function(e,h){var j,k,l,o,q,r,s,t,v,w;j=h.interpolateUrl,k=h.results,l=h.next,o=p(e,a,j),q=function(){var a,b,c,d,e=[];for(a=0,c=(b=k).length;c>a;++a)d=b[a],e.push(o(d));return e},r=[n],s=function(a){function b(a,b){var c;return b?(c=i(b),c.on("value",d,void 0,n),c.on("value",w(a),void 0,c),c):n}var c,e,f,g,h,j;for(e=[],f=0,h=(g=r).length;h>f;++f)j=g[f],e.push(j.toString());if(c=e,!m(c,a)){for(t(),e=[],f=0,h=a.length;h>f;++f)e.push(b.call(this,f,a[f]));r=e}},t=function(){var a,b,c,d;for(a=0,c=(b=r).length;c>a;++a)d=b[a],d.off("value",void 0,d)},v=[],v.forEach||(v.forEach=f(v,g)),w=c(function(a,c){var d,e,f,g;for(v[a]=c,d=0,e=v.length;e>d;++d)if(f=d,!v[f])return;g=u.regularize(v),b(function(){l(g)})}),e.$watchCollection(q,s),e.$on("$destroy",t)}},v=function(){function a(a,b){a.$auth=function(){return b}}a.displayName="FireAuth";var b=a.prototype;return b.$login=function(){var a;(a=this.$auth()).login.apply(a,arguments)},b.$logout=function(){var a;(a=this.$auth()).logout.apply(a,arguments)},a}(),w=function(a,c){return v(a,c),b(a,v.prototype)},x=function(){function a(a,b){a.$ref=f(b,b.ref),a.$name=b.ref().name(),a.$priority=b.getPriority()}a.displayName="FireObject";var b=a.prototype;return b.$set=function(){var a;(a=this.$ref()).set.apply(a,arguments)},b.$update=function(){var a;(a=this.$ref()).update.apply(a,arguments)},b.$transaction=function(a){this.$ref().transaction(a)},b.$increase=function(){this.$transaction(function(a){return a+1})},b.$decrease=function(){this.$transaction(function(a){return a-1})},b.$setPriority=function(){var a;(a=this.$ref()).setPriority.apply(a,arguments)},b.$setWithPriority=function(){var a;(a=this.$ref()).setWithPriority.apply(a,arguments)},a}(),y=function(a){return i(a)?a:{$value:a}},z=function(a){var c;return c=y(a.val()),x(c,a),b(c,x.prototype)},t.regularize=z,A=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireCollection",d),c).prototype;return e.$push=function(a){this.$ref().push(a)},d}(x),u.regularize=function(a){var c;return c=[],a.forEach(function(a){var b;b=z(a),b.$index=-1+c.push(b)}),j(a.ref)&&(A(c,a),b(c,A.prototype)),c},B=["$q","$parse","$immediate","Firebase","FirebaseUrl","FirebaseSimpleLogin"].concat(function(a,b,d,e,g,h){function i(){var a=[];for(m in q)a.push(m);return a}var j,k,l,m,n,o;for(j=function(a){return a||(a=""),new e("http"===a.substr(0,4)?a:g+a)},k=0,n=(l=i()).length;n>k;++k)m=l[k],q[m]=q[m](b,d,e,h,j);return o=c(function(a,c){var d,e,g;for(d in c)e=c[d],g=b(d).assign,e._build(a,f(void 0,g,a))}),function(b){var c,d;return c=a.defer(),d=c.promise,delete c.promise,d.then(o(b)),c}}),C=FirebaseSimpleLogin||d,angular.module("angular-on-fire",[]).value({FirebaseUrl:"https://YOUR_FIREBASE_NAME.firebaseIO.com/",Firebase:Firebase}).service({fireAuthDSL:s,fireObjectDSL:t,fireCollectionDSL:u}).factory({autoInjectDSL:B}).config(["$provide","$injector"].concat(function(a,b){b.has("$immediate")||a.factory("$immediate",["$timeout"].concat(e)),b.has("FirebaseSimpleLogin")||a.value("FirebaseSimpleLogin",C)}))}).call(this);