/*! angular-on-fire - v0.2.0 - 2013-10-28
 * Copyright (c) 2013 [tomchentw](https://github.com/tomchentw/);
 * Licensed MIT */
(function(){function a(a,b){function c(){}return c.prototype=(a.superclass=b).prototype,(a.prototype=new c).constructor=a,"function"==typeof b.extended&&b.extended(a),a}function b(a,b){var c={}.hasOwnProperty;for(var d in b)c.call(b,d)&&(a[d]=b[d]);return a}function c(a,b){var c,d=function(e){return a.length>1?function(){var f=e?e.concat():[];return c=b?c||this:this,f.push.apply(f,arguments)<a.length&&arguments.length?d.call(c,f):a.apply(c,f)}:a};return d()}function d(a){function b(){}return b.prototype=a,new b}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[].slice;e=angular.noop,f=angular.identity,g=angular.bind,h=angular.forEach,i=angular.copy,j=angular.isObject,k=angular.isFunction,l=angular.isString,m=angular.isNumber,n=angular.equals,o={on:e,off:e},p=/\{\{\s*(\S*)\s*\}\}/g,q=function(a,b,c){var d,e,f,g,h,i,j;for(e=[],f=0,h=(g=c.split(p)).length;h>f;++f)i=f,j=g[f],i%2?e.push(b(j)):e.push(j);return d=e,function(b){var c,e,f,g,h,i,j;for(c="",e=0,g=(f=d).length;g>e;++e){if(h=e,i=f[e],h%2){if(j=i(a)||i(b),m(j)&&(j+=""),!l(j)||!j.length)return}else j=i;c+=j}return c}},r=function(){function a(){this.steps=[]}a.displayName="DSL";var b=a.prototype;return b._clone=function(){var a,b,c,d,e,f;for(a=new this.constructor,b=a.steps,c=0,e=(d=this.steps).length;e>c;++c)f=d[c],b.push(i(f,{}));return a},b._cloneThenPush=function(a){var b;return b=this._clone(),b.steps.push(a),b},b._build=function(){delete this.steps},a}(),s=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireAuthDSL",d),c).prototype;return e.root=function(a){var b,c;return b=this._clone(),((c=b.steps)[0]||(c[0]={})).root=a,b},e._build=function(a,b){var d;d=this.steps[0],d.next=b,r.auth(a,d),c.prototype._build.apply(this,arguments)},d}(r),t=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireObjectDSL",d),c).prototype;return e._build=function(a,b){var d,e,f,g,i;d=this.steps,f=0<(e=d.length-1)?D.call(d,0,e):(e=0,[]),g=d[e],i=f[0]||g,g.next=b,h(f,function(b,c){var d;d=f[c+1]||g,b.next=function(b){r[d.type](a,(d.results=b,d))}}),r[i.type](a,i),c.prototype._build.apply(this,arguments)},e.get=function(a,b){return this._cloneThenPush({type:"get",interpolateUrl:a,query:b||{},regularize:this.constructor.regularize})},d}(r),u=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireCollectionDSL",d),c).prototype;return e.map=function(a){return this._cloneThenPush({type:"map",interpolateUrl:a})},e.flatten=function(){return this._cloneThenPush({type:"flatten"})},d}(t),r.auth=function(a,b,c,d){return function(a,e){var f,g,h;f=e.root,g=e.next,h=new d(new c(f),function(a,c){(a||!c)&&(c={}),b(function(){g(w(c,h))})})}},r.flatten=function(a,b){return function(a,c){function d(a,b){b.match(/^\$/)||(a=y(a),a.$name=b,a.$index=-1+g.push(a))}var e,f,g,i,j,k;for(e=c.results,f=c.next,g=[],i=0,j=e.length;j>i;++i)k=e[i],h(k,d);b(function(){f(g)})}},r.get=function(a,b,c,d,f){return function(c,d){var g,h,i,j,k,m,n,p,r,s,t,u,v,w;g=d.interpolateUrl,h=d.query,i=d.regularize,j=d.next,k=q(c,a,g),n=[];for(p in h)n.push(p);m=n,r=function(a){var b,c,d,e,f,g;for(b={url:k(a)},c=0,e=(d=m).length;e>c;++c){if(f=d[c],g=a.$eval(h[f]),!g)return{};b[f]=g}return b},s=o,t=function(a){return u(),l(a.url)?(s=f(a),s.on("value",e,void 0,o),s.on("value",w,void 0,s),void 0):j(void 0)},u=function(){s.off("value",void 0,s)},v=null,w=function(a){b(function(){j(i(a))})},c.$watch(r,t,!0),c.$on("$destroy",u)}},r.map=function(a,b,d,f,i){var j;return j=/\{\{\s*(\S*)\s*\}\}/g,function(d,f){var j,k,l,m,p,r,s,t,v,w;j=f.interpolateUrl,k=f.results,l=f.next,m=q(d,a,j),p=function(){var a,b,c,d,e=[];for(a=0,c=(b=k).length;c>a;++a)d=b[a],e.push(m(d));return e},r=[o],s=function(a){function b(a,b){var c;return b?(c=i({url:b}),c.on("value",e,void 0,o),c.on("value",w(a),void 0,c),c):o}var c,d,f,g,h,j;for(d=[],f=0,h=(g=r).length;h>f;++f)j=g[f],d.push(j.toString());if(c=d,!n(c,a)){for(t(),d=[],f=0,h=a.length;h>f;++f)d.push(b.call(this,f,a[f]));r=d}},t=function(){var a,b,c,d;for(a=0,c=(b=r).length;c>a;++a)d=b[a],d.off("value",void 0,d)},v=[],v.length=k.length,v.forEach||(v.forEach=g(v,h)),k.length||b(function(){return l([])}),w=c(function(a,c){var d,e,f,g;for(v[a]=c,d=0,e=v.length;e>d;++d)if(f=d,!v[f])return;g=u.regularize(v),b(function(){l(g)})}),d.$watchCollection(p,s),d.$on("$destroy",t)}},v=function(){function a(a,b){return this.$auth=g(this,f,b),i(a,d(this))}a.displayName="FireAuth";var b=a.prototype;return b.$login=function(){var a;(a=this.$auth()).login.apply(a,arguments)},b.$logout=function(){var a;(a=this.$auth()).logout.apply(a,arguments)},a}(),w=function(a,b){return new v(a,b)},x=function(){function a(a,b){a.$ref=g(b,b.ref),a.$name=b.ref().name(),a.$priority=b.getPriority()}a.displayName="FireObject";var b=a.prototype;return b.$set=function(){var a;return(a=this.$ref()).set.apply(a,arguments)},b.$update=function(){var a;return(a=this.$ref()).update.apply(a,arguments)},b.$transaction=function(){var a;return(a=this.$ref()).transaction.apply(a,arguments)},b.$increase=function(){var a;return a=D.call(arguments),a.unshift(function(a){return a+1}),this.$transaction.apply(this,a)},b.$decrease=function(){var a;return a=D.call(arguments),a.unshift(function(a){return a-1}),this.$transaction.apply(this,a)},b.$setPriority=function(){var a;return(a=this.$ref()).setPriority.apply(a,arguments)},b.$setWithPriority=function(){var a;return(a=this.$ref()).setWithPriority.apply(a,arguments)},b.$remove=function(){var a;return(a=this.$ref()).remove.apply(a,arguments)},a}(),y=function(a){return j(a)?a:{$value:a}},z=function(a){var c;return c=y(a.val()),x(c,a),b(c,x.prototype)},t.regularize=z,A=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireCollection",d),c).prototype;return e.$push=function(){var a;return(a=this.$ref()).push.apply(a,arguments)},d}(x),u.regularize=function(a){var c;return c=[],a.forEach(function(a){var b;b=z(a),b.$index=-1+c.push(b)}),k(a.ref)&&(A(c,a),b(c,A.prototype)),c},B=["$q","$parse","$immediate","Firebase","FirebaseUrl","FirebaseSimpleLogin"].concat(function(a,b,d,e,f,h){function i(){var a,b=[];for(o in a=r)p=a[o],k(p)&&b.push(o);return b}var j,l,m,n,o,p,q,s;for(j=["limit","startAt","endAt"],l=function(a){var b,c,d,g,h,i,k;for(b=a.url,c=new e("http"===b.substr(0,4)?b:f+b),d=0,h=(g=j).length;h>d;++d)if(i=g[d],k=a[i]){if(!isArray(k))continue;c=c[i].apply(c,k)}return c},m=0,q=(n=i()).length;q>m;++m)o=n[m],r[o]=r[o](b,d,e,h,l);return s=c(function(a,c){var d,e,f;for(d in c)e=c[d],f=b(d).assign,e._build(a,g(void 0,f,a))}),function(b){var c,d;return c=a.defer(),d=c.promise,delete c.promise,d.then(s(b)),c}}),C=FirebaseSimpleLogin||e,angular.module("angular-on-fire",[]).value({FirebaseUrl:"https://YOUR_FIREBASE_NAME.firebaseIO.com/",Firebase:Firebase}).service({fireAuthDSL:s,fireObjectDSL:t,fireCollectionDSL:u}).factory({autoInjectDSL:B}).config(["$provide","$injector"].concat(function(a,b){b.has("$immediate")||a.factory("$immediate",["$timeout"].concat(f)),b.has("FirebaseSimpleLogin")||a.value("FirebaseSimpleLogin",C)}))}).call(this);