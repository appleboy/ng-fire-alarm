/*! angular-on-fire - v0.1.0 - 2013-10-22
* Copyright (c) 2013 [tomchentw](https://github.com/tomchentw/);
 Licensed MIT */
(function(){function a(a){function b(){}return b.prototype=a,new b}function b(a,b){function c(){}return c.prototype=(a.superclass=b).prototype,(a.prototype=new c).constructor=a,"function"==typeof b.extended&&b.extended(a),a}function c(a,b){var c={}.hasOwnProperty;for(var d in b)c.call(b,d)&&(a[d]=b[d]);return a}function d(a,b){var c,d=function(e){return a.length>1?function(){var f=e?e.concat():[];return c=b?c||this:this,f.push.apply(f,arguments)<a.length&&arguments.length?d.call(c,f):a.apply(c,f)}:a};return d()}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;e=angular.noop,f=angular.identity,g=angular.bind,h=angular.forEach,i=angular.copy,j=angular.isObject,k=angular.isFunction,l=angular.isString,m=angular.isNumber,n=angular.equals,o={on:e,off:e},p=/\{\{\s*(\S*)\s*\}\}/g,q=function(a,b,c){var d,e,f,g,h,i,j;for(e=[],f=0,h=(g=c.split(p)).length;h>f;++f)i=f,j=g[f],i%2?e.push(b(j)):e.push(j);return d=e,function(b){var c,e,f,g,h,i,j;for(c="",e=0,g=(f=d).length;g>e;++e){if(h=e,i=f[e],h%2){if(j=i(a)||i(b),m(j)&&(j+=""),!l(j)||!j.length)return}else j=i;c+=j}return c}},r={},r.auth=function(b,c,d,e){return function(b,f){var g,h,j;g=f.root,h=f.next,j=new e(new d(g),function(b,d){c(function(){h(i(b||!d?{}:d,a(j)))})})}},s=function(){function a(){}a.displayName="DSL";var b=a.prototype;return b._cloneThenPush=function(a){var b,c,d,e,f,g;if(b=new this.constructor,c=[],this.steps)for(d=0,f=(e=this.steps).length;f>d;++d)g=e[d],c.push(i(g,{}));return c.push(a),b.steps=c,b},b._build=function(){delete this.steps},a}(),t=function(a){function d(){d.superclass.apply(this,arguments)}var e=b((c(d,a).displayName="FireAuthDSL",d),a).prototype;return e.root=function(a){var b;return((b=this.steps||(this.steps=[]))[0]||(b[0]={})).root=a,this},e._build=function(b,c){var d;d=this.steps[0],d.next=c,r.auth(b,d),a.prototype._build.apply(this,arguments)},d}(s),u=function(a){function d(){d.superclass.apply(this,arguments)}var e=b((c(d,a).displayName="FireObjectDSL",d),a).prototype;return e._build=function(b,c){var d,e,f;d=this.steps,e=d.length,f=d[0],f.regularize=this.constructor.regularize,1===e?f.next=c:h(d,function(a,f){var g;a.next=f!==e-1?(g=d[f+1],function(a){return r[g.type](b,(g.results=a,g))}):c}),r[f.type](b,f),a.prototype._build.apply(this,arguments)},e.get=function(a){return this._cloneThenPush({type:"get",interpolateUrl:a})},d}(s),v=function(a){function d(){d.superclass.apply(this,arguments)}var e=b((c(d,a).displayName="FireCollectionDSL",d),a).prototype;return e.map=function(a){return this._cloneThenPush({type:"map",interpolateUrl:a})},e.flatten=function(){return this._cloneThenPush({type:"flatten"})},d}(u),r.flatten=function(a,b){return function(a,c){function d(a,b){"$"!==b[0]&&(a=x(a),a.$name=b,a.$index=-1+g.push(a))}var e,f,g,i,j,k;for(e=c.results,f=c.next,g=[],i=0,j=e.length;j>i;++i)k=e[i],h(k,d);b(function(){f(g)})}},r.get=function(a,b,c,d,f){return function(c,d){var g,h,i,j,k,m,n,p,r;g=d.interpolateUrl,h=d.regularize,i=d.next,j=q(c,a,g),k=o,m=function(a){if(k.toString()!==a){if(n(),!l(a))return i(void 0);k=f(a),k.on("value",e,void 0,o),k.on("value",r,void 0,k)}},n=function(){k.off("value",void 0,k)},p=null,r=function(a){b(function(){i(h(a))})},c.$watch(j,m),c.$on("$destroy",n)}},r.map=function(a,b,c,f,i){var j;return j=/\{\{\s*(\S*)\s*\}\}/g,function(c,f){var j,k,l,m,p,r,s,t,u,w;j=f.interpolateUrl,k=f.results,l=f.next,m=q(c,a,j),p=function(){var a,b,c,d,e=[];for(a=0,c=(b=k).length;c>a;++a)d=b[a],e.push(m(d));return e},r=[o],s=function(a){function b(a,b){var c;return b?(c=i(b),c.on("value",e,void 0,o),c.on("value",w(a),void 0,c),c):o}var c,d,f,g,h,j;for(d=[],f=0,h=(g=r).length;h>f;++f)j=g[f],d.push(j.toString());if(c=d,!n(c,a)){for(t(),d=[],f=0,h=a.length;h>f;++f)d.push(b.call(this,f,a[f]));r=d}},t=function(){var a,b,c,d;for(a=0,c=(b=r).length;c>a;++a)d=b[a],d.off("value",void 0,d)},u=[],u.forEach||(u.forEach=g(u,h)),w=d(function(a,c){var d,e,f,g;for(u[a]=c,d=0,e=u.length;e>d;++d)if(f=d,!u[f])return;g=v.regularize(u),b(function(){l(g)})}),c.$watchCollection(p,s),c.$on("$destroy",t)}},w=function(){function a(a,b){a.$ref=g(b,b.ref),a.$name=b.ref().name(),a.$priority=b.getPriority()}a.displayName="FireObject";var b=a.prototype;return b.$set=function(){var a;(a=this.$ref()).set.apply(a,arguments)},b.$update=function(){var a;(a=this.$ref()).update.apply(a,arguments)},b.$transaction=function(a){this.$ref().transaction(a)},b.$increase=function(){this.$transaction(function(a){return a+1})},b.$decrease=function(){this.$transaction(function(a){return a-1})},b.$setPriority=function(){var a;(a=this.$ref()).setPriority.apply(a,arguments)},b.$setWithPriority=function(){var a;(a=this.$ref()).setWithPriority.apply(a,arguments)},a}(),x=function(a){return j(a)?a:{$value:a}},y=function(a){var b;return b=x(a.val()),w(b,a),c(b,w.prototype)},u.regularize=y,z=function(a){function d(){d.superclass.apply(this,arguments)}var e=b((c(d,a).displayName="FireCollection",d),a).prototype;return e.$push=function(a){this.$ref().push(a)},d}(w),v.regularize=function(a){var b;return b=[],a.forEach(function(a){var c;c=y(a),c.$index=-1+b.push(c)}),k(a.ref)&&(z(b,a),c(b,z.prototype)),b},A=["$q","$parse","$immediate","Firebase","FirebaseUrl","FirebaseSimpleLogin"].concat(function(a,b,c,e,f,g){function i(){var a=[];for(m in r)a.push(m);return a}var j,k,l,m,n,o;for(j=function(a){return a||(a=""),new e("http"===a.substr(0,4)?a:f+a)},k=0,n=(l=i()).length;n>k;++k)m=l[k],r[m]=r[m](b,c,e,g,j);return o=d(function(a,b){h(b,function(b,c){b._build(a,function(b){a[c]=b})})}),function(b){var c,d;return c=a.defer(),d=c.promise,delete c.promise,d.then(o(b)),c}}),B=FirebaseSimpleLogin||e,angular.module("angular-on-fire",[]).value({FirebaseUrl:"https://YOUR_FIREBASE_NAME.firebaseIO.com/",Firebase:Firebase}).service({fireAuthDSL:t,fireObjectDSL:u,fireCollectionDSL:v}).factory({autoInjectDSL:A}).config(["$provide","$injector"].concat(function(a,b){b.has("$immediate")||a.factory("$immediate",["$timeout"].concat(f)),b.has("FirebaseSimpleLogin")||a.value("FirebaseSimpleLogin",B)}))}).call(this);