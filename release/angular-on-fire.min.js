/*! angular-on-fire - v0.2.0 - 2013-10-22
 * Copyright (c) 2013 [tomchentw](https://github.com/tomchentw/);
 * Licensed MIT */
(function(){function a(a,b){function c(){}return c.prototype=(a.superclass=b).prototype,(a.prototype=new c).constructor=a,"function"==typeof b.extended&&b.extended(a),a}function b(a,b){var c={}.hasOwnProperty;for(var d in b)c.call(b,d)&&(a[d]=b[d]);return a}function c(a,b){var c,d=function(e){return a.length>1?function(){var f=e?e.concat():[];return c=b?c||this:this,f.push.apply(f,arguments)<a.length&&arguments.length?d.call(c,f):a.apply(c,f)}:a};return d()}function d(a){function b(){}return b.prototype=a,new b}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[].slice;e=angular.noop,f=angular.identity,g=angular.bind,h=angular.forEach,i=angular.copy,j=angular.isObject,k=angular.isFunction,l=angular.isString,m=angular.isNumber,n=angular.equals,o={on:e,off:e},p=/\{\{\s*(\S*)\s*\}\}/g,q=function(a,b,c){var d,e,f,g,h,i,j;for(e=[],f=0,h=(g=c.split(p)).length;h>f;++f)i=f,j=g[f],i%2?e.push(b(j)):e.push(j);return d=e,function(b){var c,e,f,g,h,i,j;for(c="",e=0,g=(f=d).length;g>e;++e){if(h=e,i=f[e],h%2){if(j=i(a)||i(b),m(j)&&(j+=""),!l(j)||!j.length)return}else j=i;c+=j}return c}},r={},r.auth=function(a,b,c,d){return function(a,e){var f,g,h;f=e.root,g=e.next,h=new d(new c(f),function(a,c){(a||!c)&&(c={}),b(function(){g(x(c,h))})})}},s=function(){function a(){}a.displayName="DSL";var b=a.prototype;return b._cloneThenPush=function(a){var b,c,d,e,f,g;if(b=new this.constructor,c=[],this.steps)for(d=0,f=(e=this.steps).length;f>d;++d)g=e[d],c.push(i(g,{}));return c.push(a),b.steps=c,b},b._build=function(){delete this.steps},a}(),t=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireAuthDSL",d),c).prototype;return e.root=function(a){var b;return((b=this.steps||(this.steps=[]))[0]||(b[0]={})).root=a,this},e._build=function(a,b){var d;d=this.steps[0],d.next=b,r.auth(a,d),c.prototype._build.apply(this,arguments)},d}(s),u=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireObjectDSL",d),c).prototype;return e._build=function(a,b){var d,e,f,g,i;d=this.steps,f=0<(e=d.length-1)?E.call(d,0,e):(e=0,[]),g=d[e],i=f[0]||g,g.next=b,h(f,function(b,c){var d;d=f[c+1]||g,b.next=function(b){r[d.type](a,(d.results=b,d))}}),r[i.type](a,i),c.prototype._build.apply(this,arguments)},e.get=function(a){return this._cloneThenPush({type:"get",interpolateUrl:a,regularize:this.constructor.regularize})},d}(s),v=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireCollectionDSL",d),c).prototype;return e.map=function(a){return this._cloneThenPush({type:"map",interpolateUrl:a})},e.flatten=function(){return this._cloneThenPush({type:"flatten"})},d}(u),r.flatten=function(a,b){return function(a,c){function d(a,b){b.match(/^\$/)||(a=z(a),a.$name=b,a.$index=-1+g.push(a))}var e,f,g,i,j,k;for(e=c.results,f=c.next,g=[],i=0,j=e.length;j>i;++i)k=e[i],h(k,d);b(function(){f(g)})}},r.get=function(a,b,c,d,f){return function(c,d){var g,h,i,j,k,m,n,p,r;g=d.interpolateUrl,h=d.regularize,i=d.next,j=q(c,a,g),k=o,m=function(a){if(k.toString()!==a){if(n(),!l(a))return i(void 0);k=f(a),k.on("value",e,void 0,o),k.on("value",r,void 0,k)}},n=function(){k.off("value",void 0,k)},p=null,r=function(a){b(function(){i(h(a))})},c.$watch(j,m),c.$on("$destroy",n)}},r.map=function(a,b,d,f,i){var j;return j=/\{\{\s*(\S*)\s*\}\}/g,function(d,f){var j,k,l,m,p,r,s,t,u,w;j=f.interpolateUrl,k=f.results,l=f.next,m=q(d,a,j),p=function(){var a,b,c,d,e=[];for(a=0,c=(b=k).length;c>a;++a)d=b[a],e.push(m(d));return e},r=[o],s=function(a){function b(a,b){var c;return b?(c=i(b),c.on("value",e,void 0,o),c.on("value",w(a),void 0,c),c):o}var c,d,f,g,h,j;for(d=[],f=0,h=(g=r).length;h>f;++f)j=g[f],d.push(j.toString());if(c=d,!n(c,a)){for(t(),d=[],f=0,h=a.length;h>f;++f)d.push(b.call(this,f,a[f]));r=d}},t=function(){var a,b,c,d;for(a=0,c=(b=r).length;c>a;++a)d=b[a],d.off("value",void 0,d)},u=[],u.length=k.length,u.forEach||(u.forEach=g(u,h)),w=c(function(a,c){var d,e,f,g;for(u[a]=c,d=0,e=u.length;e>d;++d)if(f=d,!u[f])return;g=v.regularize(u),b(function(){l(g)})}),d.$watchCollection(p,s),d.$on("$destroy",t)}},w=function(){function a(a,b){return this.$auth=function(){return b},i(a,d(this))}a.displayName="FireAuth";var b=a.prototype;return b.$login=function(){var a;(a=this.$auth()).login.apply(a,arguments)},b.$logout=function(){var a;(a=this.$auth()).logout.apply(a,arguments)},a}(),x=function(a,b){return new w(a,b)},y=function(){function a(a,b){a.$ref=g(b,b.ref),a.$name=b.ref().name(),a.$priority=b.getPriority()}a.displayName="FireObject";var b=a.prototype;return b.$set=function(){var a;(a=this.$ref()).set.apply(a,arguments)},b.$update=function(){var a;(a=this.$ref()).update.apply(a,arguments)},b.$transaction=function(a){this.$ref().transaction(a)},b.$increase=function(){this.$transaction(function(a){return a+1})},b.$decrease=function(){this.$transaction(function(a){return a-1})},b.$setPriority=function(){var a;(a=this.$ref()).setPriority.apply(a,arguments)},b.$setWithPriority=function(){var a;(a=this.$ref()).setWithPriority.apply(a,arguments)},a}(),z=function(a){return j(a)?a:{$value:a}},A=function(a){var c;return c=z(a.val()),y(c,a),b(c,y.prototype)},u.regularize=A,B=function(c){function d(){d.superclass.apply(this,arguments)}var e=a((b(d,c).displayName="FireCollection",d),c).prototype;return e.$push=function(a){this.$ref().push(a)},d}(y),v.regularize=function(a){var c;return c=[],a.forEach(function(a){var b;b=A(a),b.$index=-1+c.push(b)}),k(a.ref)&&(B(c,a),b(c,B.prototype)),c},C=["$q","$parse","$immediate","Firebase","FirebaseUrl","FirebaseSimpleLogin"].concat(function(a,b,d,e,f,h){function i(){var a=[];for(m in r)a.push(m);return a}var j,k,l,m,n,o;for(j=function(a){return a||(a=""),new e("http"===a.substr(0,4)?a:f+a)},k=0,n=(l=i()).length;n>k;++k)m=l[k],r[m]=r[m](b,d,e,h,j);return o=c(function(a,c){var d,e,f;for(d in c)e=c[d],f=b(d).assign,e._build(a,g(void 0,f,a))}),function(b){var c,d;return c=a.defer(),d=c.promise,delete c.promise,d.then(o(b)),c}}),D=FirebaseSimpleLogin||e,angular.module("angular-on-fire",[]).value({FirebaseUrl:"https://YOUR_FIREBASE_NAME.firebaseIO.com/",Firebase:Firebase}).service({fireAuthDSL:t,fireObjectDSL:u,fireCollectionDSL:v}).factory({autoInjectDSL:C}).config(["$provide","$injector"].concat(function(a,b){b.has("$immediate")||a.factory("$immediate",["$timeout"].concat(f)),b.has("FirebaseSimpleLogin")||a.value("FirebaseSimpleLogin",D)}))}).call(this);